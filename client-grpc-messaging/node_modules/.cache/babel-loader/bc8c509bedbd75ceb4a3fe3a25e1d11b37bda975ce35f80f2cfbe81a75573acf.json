{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2022 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LoadBalancingCall = void 0;\nconst connectivity_state_1 = require(\"./connectivity-state\");\nconst constants_1 = require(\"./constants\");\nconst deadline_1 = require(\"./deadline\");\nconst metadata_1 = require(\"./metadata\");\nconst picker_1 = require(\"./picker\");\nconst uri_parser_1 = require(\"./uri-parser\");\nconst logging = require(\"./logging\");\nconst control_plane_status_1 = require(\"./control-plane-status\");\nconst http2 = require(\"http2\");\nconst TRACER_NAME = 'load_balancing_call';\nclass LoadBalancingCall {\n  constructor(channel, callConfig, methodName, host, credentials, deadline, callNumber) {\n    var _a, _b;\n    this.channel = channel;\n    this.callConfig = callConfig;\n    this.methodName = methodName;\n    this.host = host;\n    this.credentials = credentials;\n    this.deadline = deadline;\n    this.callNumber = callNumber;\n    this.child = null;\n    this.readPending = false;\n    this.pendingMessage = null;\n    this.pendingHalfClose = false;\n    this.ended = false;\n    this.metadata = null;\n    this.listener = null;\n    this.onCallEnded = null;\n    this.childStartTime = null;\n    const splitPath = this.methodName.split('/');\n    let serviceName = '';\n    /* The standard path format is \"/{serviceName}/{methodName}\", so if we split\n     * by '/', the first item should be empty and the second should be the\n     * service name */\n    if (splitPath.length >= 2) {\n      serviceName = splitPath[1];\n    }\n    const hostname = (_b = (_a = (0, uri_parser_1.splitHostPort)(this.host)) === null || _a === void 0 ? void 0 : _a.host) !== null && _b !== void 0 ? _b : 'localhost';\n    /* Currently, call credentials are only allowed on HTTPS connections, so we\n     * can assume that the scheme is \"https\" */\n    this.serviceUrl = `https://${hostname}/${serviceName}`;\n    this.startTime = new Date();\n  }\n  getDeadlineInfo() {\n    var _a, _b;\n    const deadlineInfo = [];\n    if (this.childStartTime) {\n      if (this.childStartTime > this.startTime) {\n        if ((_a = this.metadata) === null || _a === void 0 ? void 0 : _a.getOptions().waitForReady) {\n          deadlineInfo.push('wait_for_ready');\n        }\n        deadlineInfo.push(`LB pick: ${(0, deadline_1.formatDateDifference)(this.startTime, this.childStartTime)}`);\n      }\n      deadlineInfo.push(...this.child.getDeadlineInfo());\n      return deadlineInfo;\n    } else {\n      if ((_b = this.metadata) === null || _b === void 0 ? void 0 : _b.getOptions().waitForReady) {\n        deadlineInfo.push('wait_for_ready');\n      }\n      deadlineInfo.push('Waiting for LB pick');\n    }\n    return deadlineInfo;\n  }\n  trace(text) {\n    logging.trace(constants_1.LogVerbosity.DEBUG, TRACER_NAME, '[' + this.callNumber + '] ' + text);\n  }\n  outputStatus(status, progress) {\n    var _a, _b;\n    if (!this.ended) {\n      this.ended = true;\n      this.trace('ended with status: code=' + status.code + ' details=\"' + status.details + '\" start time=' + this.startTime.toISOString());\n      const finalStatus = Object.assign(Object.assign({}, status), {\n        progress\n      });\n      (_a = this.listener) === null || _a === void 0 ? void 0 : _a.onReceiveStatus(finalStatus);\n      (_b = this.onCallEnded) === null || _b === void 0 ? void 0 : _b.call(this, finalStatus.code);\n    }\n  }\n  doPick() {\n    var _a, _b;\n    if (this.ended) {\n      return;\n    }\n    if (!this.metadata) {\n      throw new Error('doPick called before start');\n    }\n    this.trace('Pick called');\n    const finalMetadata = this.metadata.clone();\n    const pickResult = this.channel.doPick(finalMetadata, this.callConfig.pickInformation);\n    const subchannelString = pickResult.subchannel ? '(' + pickResult.subchannel.getChannelzRef().id + ') ' + pickResult.subchannel.getAddress() : '' + pickResult.subchannel;\n    this.trace('Pick result: ' + picker_1.PickResultType[pickResult.pickResultType] + ' subchannel: ' + subchannelString + ' status: ' + ((_a = pickResult.status) === null || _a === void 0 ? void 0 : _a.code) + ' ' + ((_b = pickResult.status) === null || _b === void 0 ? void 0 : _b.details));\n    switch (pickResult.pickResultType) {\n      case picker_1.PickResultType.COMPLETE:\n        this.credentials.generateMetadata({\n          service_url: this.serviceUrl\n        }).then(credsMetadata => {\n          var _a, _b, _c;\n          /* If this call was cancelled (e.g. by the deadline) before\n           * metadata generation finished, we shouldn't do anything with\n           * it. */\n          if (this.ended) {\n            this.trace('Credentials metadata generation finished after call ended');\n            return;\n          }\n          finalMetadata.merge(credsMetadata);\n          if (finalMetadata.get('authorization').length > 1) {\n            this.outputStatus({\n              code: constants_1.Status.INTERNAL,\n              details: '\"authorization\" metadata cannot have multiple values',\n              metadata: new metadata_1.Metadata()\n            }, 'PROCESSED');\n          }\n          if (pickResult.subchannel.getConnectivityState() !== connectivity_state_1.ConnectivityState.READY) {\n            this.trace('Picked subchannel ' + subchannelString + ' has state ' + connectivity_state_1.ConnectivityState[pickResult.subchannel.getConnectivityState()] + ' after getting credentials metadata. Retrying pick');\n            this.doPick();\n            return;\n          }\n          if (this.deadline !== Infinity) {\n            finalMetadata.set('grpc-timeout', (0, deadline_1.getDeadlineTimeoutString)(this.deadline));\n          }\n          try {\n            this.child = pickResult.subchannel.getRealSubchannel().createCall(finalMetadata, this.host, this.methodName, {\n              onReceiveMetadata: metadata => {\n                this.trace('Received metadata');\n                this.listener.onReceiveMetadata(metadata);\n              },\n              onReceiveMessage: message => {\n                this.trace('Received message');\n                this.listener.onReceiveMessage(message);\n              },\n              onReceiveStatus: status => {\n                this.trace('Received status');\n                if (status.rstCode === http2.constants.NGHTTP2_REFUSED_STREAM) {\n                  this.outputStatus(status, 'REFUSED');\n                } else {\n                  this.outputStatus(status, 'PROCESSED');\n                }\n              }\n            });\n            this.childStartTime = new Date();\n          } catch (error) {\n            this.trace('Failed to start call on picked subchannel ' + subchannelString + ' with error ' + error.message);\n            this.outputStatus({\n              code: constants_1.Status.INTERNAL,\n              details: 'Failed to start HTTP/2 stream with error ' + error.message,\n              metadata: new metadata_1.Metadata()\n            }, 'NOT_STARTED');\n            return;\n          }\n          (_b = (_a = this.callConfig).onCommitted) === null || _b === void 0 ? void 0 : _b.call(_a);\n          (_c = pickResult.onCallStarted) === null || _c === void 0 ? void 0 : _c.call(pickResult);\n          this.onCallEnded = pickResult.onCallEnded;\n          this.trace('Created child call [' + this.child.getCallNumber() + ']');\n          if (this.readPending) {\n            this.child.startRead();\n          }\n          if (this.pendingMessage) {\n            this.child.sendMessageWithContext(this.pendingMessage.context, this.pendingMessage.message);\n          }\n          if (this.pendingHalfClose) {\n            this.child.halfClose();\n          }\n        }, error => {\n          // We assume the error code isn't 0 (Status.OK)\n          const {\n            code,\n            details\n          } = (0, control_plane_status_1.restrictControlPlaneStatusCode)(typeof error.code === 'number' ? error.code : constants_1.Status.UNKNOWN, `Getting metadata from plugin failed with error: ${error.message}`);\n          this.outputStatus({\n            code: code,\n            details: details,\n            metadata: new metadata_1.Metadata()\n          }, 'PROCESSED');\n        });\n        break;\n      case picker_1.PickResultType.DROP:\n        const {\n          code,\n          details\n        } = (0, control_plane_status_1.restrictControlPlaneStatusCode)(pickResult.status.code, pickResult.status.details);\n        setImmediate(() => {\n          this.outputStatus({\n            code,\n            details,\n            metadata: pickResult.status.metadata\n          }, 'DROP');\n        });\n        break;\n      case picker_1.PickResultType.TRANSIENT_FAILURE:\n        if (this.metadata.getOptions().waitForReady) {\n          this.channel.queueCallForPick(this);\n        } else {\n          const {\n            code,\n            details\n          } = (0, control_plane_status_1.restrictControlPlaneStatusCode)(pickResult.status.code, pickResult.status.details);\n          setImmediate(() => {\n            this.outputStatus({\n              code,\n              details,\n              metadata: pickResult.status.metadata\n            }, 'PROCESSED');\n          });\n        }\n        break;\n      case picker_1.PickResultType.QUEUE:\n        this.channel.queueCallForPick(this);\n    }\n  }\n  cancelWithStatus(status, details) {\n    var _a;\n    this.trace('cancelWithStatus code: ' + status + ' details: \"' + details + '\"');\n    (_a = this.child) === null || _a === void 0 ? void 0 : _a.cancelWithStatus(status, details);\n    this.outputStatus({\n      code: status,\n      details: details,\n      metadata: new metadata_1.Metadata()\n    }, 'PROCESSED');\n  }\n  getPeer() {\n    var _a, _b;\n    return (_b = (_a = this.child) === null || _a === void 0 ? void 0 : _a.getPeer()) !== null && _b !== void 0 ? _b : this.channel.getTarget();\n  }\n  start(metadata, listener) {\n    this.trace('start called');\n    this.listener = listener;\n    this.metadata = metadata;\n    this.doPick();\n  }\n  sendMessageWithContext(context, message) {\n    this.trace('write() called with message of length ' + message.length);\n    if (this.child) {\n      this.child.sendMessageWithContext(context, message);\n    } else {\n      this.pendingMessage = {\n        context,\n        message\n      };\n    }\n  }\n  startRead() {\n    this.trace('startRead called');\n    if (this.child) {\n      this.child.startRead();\n    } else {\n      this.readPending = true;\n    }\n  }\n  halfClose() {\n    this.trace('halfClose called');\n    if (this.child) {\n      this.child.halfClose();\n    } else {\n      this.pendingHalfClose = true;\n    }\n  }\n  setCredentials(credentials) {\n    throw new Error('Method not implemented.');\n  }\n  getCallNumber() {\n    return this.callNumber;\n  }\n}\nexports.LoadBalancingCall = LoadBalancingCall;","map":{"version":3,"names":["connectivity_state_1","require","constants_1","deadline_1","metadata_1","picker_1","uri_parser_1","logging","control_plane_status_1","http2","TRACER_NAME","LoadBalancingCall","constructor","channel","callConfig","methodName","host","credentials","deadline","callNumber","child","readPending","pendingMessage","pendingHalfClose","ended","metadata","listener","onCallEnded","childStartTime","splitPath","split","serviceName","length","hostname","_b","_a","splitHostPort","serviceUrl","startTime","Date","getDeadlineInfo","deadlineInfo","getOptions","waitForReady","push","formatDateDifference","trace","text","LogVerbosity","DEBUG","outputStatus","status","progress","code","details","toISOString","finalStatus","Object","assign","onReceiveStatus","call","doPick","Error","finalMetadata","clone","pickResult","pickInformation","subchannelString","subchannel","getChannelzRef","id","getAddress","PickResultType","pickResultType","COMPLETE","generateMetadata","service_url","then","credsMetadata","merge","get","Status","INTERNAL","Metadata","getConnectivityState","ConnectivityState","READY","Infinity","set","getDeadlineTimeoutString","getRealSubchannel","createCall","onReceiveMetadata","onReceiveMessage","message","rstCode","constants","NGHTTP2_REFUSED_STREAM","error","onCommitted","_c","onCallStarted","getCallNumber","startRead","sendMessageWithContext","context","halfClose","restrictControlPlaneStatusCode","UNKNOWN","DROP","setImmediate","TRANSIENT_FAILURE","queueCallForPick","QUEUE","cancelWithStatus","getPeer","getTarget","start","setCredentials","exports"],"sources":["/Users/husseinmohamed/Desktop/Learn_Rust/projects/grpc-project/client-grpc-messaging/node_modules/@grpc/grpc-js/src/load-balancing-call.ts"],"sourcesContent":["/*\n * Copyright 2022 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { CallCredentials } from './call-credentials';\nimport {\n  Call,\n  DeadlineInfoProvider,\n  InterceptingListener,\n  MessageContext,\n  StatusObject,\n} from './call-interface';\nimport { SubchannelCall } from './subchannel-call';\nimport { ConnectivityState } from './connectivity-state';\nimport { LogVerbosity, Status } from './constants';\nimport { Deadline, formatDateDifference, getDeadlineTimeoutString } from './deadline';\nimport { InternalChannel } from './internal-channel';\nimport { Metadata } from './metadata';\nimport { PickResultType } from './picker';\nimport { CallConfig } from './resolver';\nimport { splitHostPort } from './uri-parser';\nimport * as logging from './logging';\nimport { restrictControlPlaneStatusCode } from './control-plane-status';\nimport * as http2 from 'http2';\n\nconst TRACER_NAME = 'load_balancing_call';\n\nexport type RpcProgress = 'NOT_STARTED' | 'DROP' | 'REFUSED' | 'PROCESSED';\n\nexport interface StatusObjectWithProgress extends StatusObject {\n  progress: RpcProgress;\n}\n\nexport interface LoadBalancingCallInterceptingListener\n  extends InterceptingListener {\n  onReceiveStatus(status: StatusObjectWithProgress): void;\n}\n\nexport class LoadBalancingCall implements Call, DeadlineInfoProvider {\n  private child: SubchannelCall | null = null;\n  private readPending = false;\n  private pendingMessage: { context: MessageContext; message: Buffer } | null =\n    null;\n  private pendingHalfClose = false;\n  private ended = false;\n  private serviceUrl: string;\n  private metadata: Metadata | null = null;\n  private listener: InterceptingListener | null = null;\n  private onCallEnded: ((statusCode: Status) => void) | null = null;\n  private startTime: Date;\n  private childStartTime: Date | null = null;\n  constructor(\n    private readonly channel: InternalChannel,\n    private readonly callConfig: CallConfig,\n    private readonly methodName: string,\n    private readonly host: string,\n    private readonly credentials: CallCredentials,\n    private readonly deadline: Deadline,\n    private readonly callNumber: number\n  ) {\n    const splitPath: string[] = this.methodName.split('/');\n    let serviceName = '';\n    /* The standard path format is \"/{serviceName}/{methodName}\", so if we split\n     * by '/', the first item should be empty and the second should be the\n     * service name */\n    if (splitPath.length >= 2) {\n      serviceName = splitPath[1];\n    }\n    const hostname = splitHostPort(this.host)?.host ?? 'localhost';\n    /* Currently, call credentials are only allowed on HTTPS connections, so we\n     * can assume that the scheme is \"https\" */\n    this.serviceUrl = `https://${hostname}/${serviceName}`;\n    this.startTime = new Date();\n  }\n  getDeadlineInfo(): string[] {\n    const deadlineInfo: string[] = [];\n    if (this.childStartTime) {\n      if (this.childStartTime > this.startTime) {\n        if (this.metadata?.getOptions().waitForReady) {\n          deadlineInfo.push('wait_for_ready');\n        }\n        deadlineInfo.push(`LB pick: ${formatDateDifference(this.startTime, this.childStartTime)}`);\n      }\n      deadlineInfo.push(...this.child!.getDeadlineInfo());\n      return deadlineInfo;\n    } else {\n      if (this.metadata?.getOptions().waitForReady) {\n        deadlineInfo.push('wait_for_ready');\n      }\n      deadlineInfo.push('Waiting for LB pick');\n    }\n    return deadlineInfo;\n  }\n\n  private trace(text: string): void {\n    logging.trace(\n      LogVerbosity.DEBUG,\n      TRACER_NAME,\n      '[' + this.callNumber + '] ' + text\n    );\n  }\n\n  private outputStatus(status: StatusObject, progress: RpcProgress) {\n    if (!this.ended) {\n      this.ended = true;\n      this.trace(\n        'ended with status: code=' +\n          status.code +\n          ' details=\"' +\n          status.details +\n          '\" start time=' +\n          this.startTime.toISOString()\n      );\n      const finalStatus = { ...status, progress };\n      this.listener?.onReceiveStatus(finalStatus);\n      this.onCallEnded?.(finalStatus.code);\n    }\n  }\n\n  doPick() {\n    if (this.ended) {\n      return;\n    }\n    if (!this.metadata) {\n      throw new Error('doPick called before start');\n    }\n    this.trace('Pick called');\n    const finalMetadata = this.metadata.clone();\n    const pickResult = this.channel.doPick(\n      finalMetadata,\n      this.callConfig.pickInformation\n    );\n    const subchannelString = pickResult.subchannel\n      ? '(' +\n        pickResult.subchannel.getChannelzRef().id +\n        ') ' +\n        pickResult.subchannel.getAddress()\n      : '' + pickResult.subchannel;\n    this.trace(\n      'Pick result: ' +\n        PickResultType[pickResult.pickResultType] +\n        ' subchannel: ' +\n        subchannelString +\n        ' status: ' +\n        pickResult.status?.code +\n        ' ' +\n        pickResult.status?.details\n    );\n    switch (pickResult.pickResultType) {\n      case PickResultType.COMPLETE:\n        this.credentials\n          .generateMetadata({ service_url: this.serviceUrl })\n          .then(\n            credsMetadata => {\n              /* If this call was cancelled (e.g. by the deadline) before\n               * metadata generation finished, we shouldn't do anything with\n               * it. */\n              if (this.ended) {\n                this.trace(\n                  'Credentials metadata generation finished after call ended'\n                );\n                return;\n              }\n              finalMetadata.merge(credsMetadata);\n              if (finalMetadata.get('authorization').length > 1) {\n                this.outputStatus(\n                  {\n                    code: Status.INTERNAL,\n                    details:\n                      '\"authorization\" metadata cannot have multiple values',\n                    metadata: new Metadata(),\n                  },\n                  'PROCESSED'\n                );\n              }\n              if (\n                pickResult.subchannel!.getConnectivityState() !==\n                ConnectivityState.READY\n              ) {\n                this.trace(\n                  'Picked subchannel ' +\n                    subchannelString +\n                    ' has state ' +\n                    ConnectivityState[\n                      pickResult.subchannel!.getConnectivityState()\n                    ] +\n                    ' after getting credentials metadata. Retrying pick'\n                );\n                this.doPick();\n                return;\n              }\n\n              if (this.deadline !== Infinity) {\n                finalMetadata.set(\n                  'grpc-timeout',\n                  getDeadlineTimeoutString(this.deadline)\n                );\n              }\n              try {\n                this.child = pickResult\n                  .subchannel!.getRealSubchannel()\n                  .createCall(finalMetadata, this.host, this.methodName, {\n                    onReceiveMetadata: metadata => {\n                      this.trace('Received metadata');\n                      this.listener!.onReceiveMetadata(metadata);\n                    },\n                    onReceiveMessage: message => {\n                      this.trace('Received message');\n                      this.listener!.onReceiveMessage(message);\n                    },\n                    onReceiveStatus: status => {\n                      this.trace('Received status');\n                      if (\n                        status.rstCode ===\n                        http2.constants.NGHTTP2_REFUSED_STREAM\n                      ) {\n                        this.outputStatus(status, 'REFUSED');\n                      } else {\n                        this.outputStatus(status, 'PROCESSED');\n                      }\n                    },\n                  });\n                this.childStartTime = new Date();\n              } catch (error) {\n                this.trace(\n                  'Failed to start call on picked subchannel ' +\n                    subchannelString +\n                    ' with error ' +\n                    (error as Error).message\n                );\n                this.outputStatus(\n                  {\n                    code: Status.INTERNAL,\n                    details:\n                      'Failed to start HTTP/2 stream with error ' +\n                      (error as Error).message,\n                    metadata: new Metadata(),\n                  },\n                  'NOT_STARTED'\n                );\n                return;\n              }\n              this.callConfig.onCommitted?.();\n              pickResult.onCallStarted?.();\n              this.onCallEnded = pickResult.onCallEnded;\n              this.trace(\n                'Created child call [' + this.child.getCallNumber() + ']'\n              );\n              if (this.readPending) {\n                this.child.startRead();\n              }\n              if (this.pendingMessage) {\n                this.child.sendMessageWithContext(\n                  this.pendingMessage.context,\n                  this.pendingMessage.message\n                );\n              }\n              if (this.pendingHalfClose) {\n                this.child.halfClose();\n              }\n            },\n            (error: Error & { code: number }) => {\n              // We assume the error code isn't 0 (Status.OK)\n              const { code, details } = restrictControlPlaneStatusCode(\n                typeof error.code === 'number' ? error.code : Status.UNKNOWN,\n                `Getting metadata from plugin failed with error: ${error.message}`\n              );\n              this.outputStatus(\n                {\n                  code: code,\n                  details: details,\n                  metadata: new Metadata(),\n                },\n                'PROCESSED'\n              );\n            }\n          );\n        break;\n      case PickResultType.DROP:\n        const { code, details } = restrictControlPlaneStatusCode(\n          pickResult.status!.code,\n          pickResult.status!.details\n        );\n        setImmediate(() => {\n          this.outputStatus(\n            { code, details, metadata: pickResult.status!.metadata },\n            'DROP'\n          );\n        });\n        break;\n      case PickResultType.TRANSIENT_FAILURE:\n        if (this.metadata.getOptions().waitForReady) {\n          this.channel.queueCallForPick(this);\n        } else {\n          const { code, details } = restrictControlPlaneStatusCode(\n            pickResult.status!.code,\n            pickResult.status!.details\n          );\n          setImmediate(() => {\n            this.outputStatus(\n              { code, details, metadata: pickResult.status!.metadata },\n              'PROCESSED'\n            );\n          });\n        }\n        break;\n      case PickResultType.QUEUE:\n        this.channel.queueCallForPick(this);\n    }\n  }\n\n  cancelWithStatus(status: Status, details: string): void {\n    this.trace(\n      'cancelWithStatus code: ' + status + ' details: \"' + details + '\"'\n    );\n    this.child?.cancelWithStatus(status, details);\n    this.outputStatus(\n      { code: status, details: details, metadata: new Metadata() },\n      'PROCESSED'\n    );\n  }\n  getPeer(): string {\n    return this.child?.getPeer() ?? this.channel.getTarget();\n  }\n  start(\n    metadata: Metadata,\n    listener: LoadBalancingCallInterceptingListener\n  ): void {\n    this.trace('start called');\n    this.listener = listener;\n    this.metadata = metadata;\n    this.doPick();\n  }\n  sendMessageWithContext(context: MessageContext, message: Buffer): void {\n    this.trace('write() called with message of length ' + message.length);\n    if (this.child) {\n      this.child.sendMessageWithContext(context, message);\n    } else {\n      this.pendingMessage = { context, message };\n    }\n  }\n  startRead(): void {\n    this.trace('startRead called');\n    if (this.child) {\n      this.child.startRead();\n    } else {\n      this.readPending = true;\n    }\n  }\n  halfClose(): void {\n    this.trace('halfClose called');\n    if (this.child) {\n      this.child.halfClose();\n    } else {\n      this.pendingHalfClose = true;\n    }\n  }\n  setCredentials(credentials: CallCredentials): void {\n    throw new Error('Method not implemented.');\n  }\n\n  getCallNumber(): number {\n    return this.callNumber;\n  }\n}\n"],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AA0BA,MAAAA,oBAAA,GAAAC,OAAA;AACA,MAAAC,WAAA,GAAAD,OAAA;AACA,MAAAE,UAAA,GAAAF,OAAA;AAEA,MAAAG,UAAA,GAAAH,OAAA;AACA,MAAAI,QAAA,GAAAJ,OAAA;AAEA,MAAAK,YAAA,GAAAL,OAAA;AACA,MAAAM,OAAA,GAAAN,OAAA;AACA,MAAAO,sBAAA,GAAAP,OAAA;AACA,MAAAQ,KAAA,GAAAR,OAAA;AAEA,MAAMS,WAAW,GAAG,qBAAqB;AAazC,MAAaC,iBAAiB;EAa5BC,YACmBC,OAAwB,EACxBC,UAAsB,EACtBC,UAAkB,EAClBC,IAAY,EACZC,WAA4B,EAC5BC,QAAkB,EAClBC,UAAkB;;IANlB,KAAAN,OAAO,GAAPA,OAAO;IACP,KAAAC,UAAU,GAAVA,UAAU;IACV,KAAAC,UAAU,GAAVA,UAAU;IACV,KAAAC,IAAI,GAAJA,IAAI;IACJ,KAAAC,WAAW,GAAXA,WAAW;IACX,KAAAC,QAAQ,GAARA,QAAQ;IACR,KAAAC,UAAU,GAAVA,UAAU;IAnBrB,KAAAC,KAAK,GAA0B,IAAI;IACnC,KAAAC,WAAW,GAAG,KAAK;IACnB,KAAAC,cAAc,GACpB,IAAI;IACE,KAAAC,gBAAgB,GAAG,KAAK;IACxB,KAAAC,KAAK,GAAG,KAAK;IAEb,KAAAC,QAAQ,GAAoB,IAAI;IAChC,KAAAC,QAAQ,GAAgC,IAAI;IAC5C,KAAAC,WAAW,GAA0C,IAAI;IAEzD,KAAAC,cAAc,GAAgB,IAAI;IAUxC,MAAMC,SAAS,GAAa,IAAI,CAACd,UAAU,CAACe,KAAK,CAAC,GAAG,CAAC;IACtD,IAAIC,WAAW,GAAG,EAAE;IACpB;;;IAGA,IAAIF,SAAS,CAACG,MAAM,IAAI,CAAC,EAAE;MACzBD,WAAW,GAAGF,SAAS,CAAC,CAAC,CAAC;IAC5B;IACA,MAAMI,QAAQ,GAAG,CAAAC,EAAA,IAAAC,EAAA,OAAA7B,YAAA,CAAA8B,aAAa,EAAC,IAAI,CAACpB,IAAI,CAAC,cAAAmB,EAAA,uBAAAA,EAAA,CAAEnB,IAAI,cAAAkB,EAAA,cAAAA,EAAA,GAAI,WAAW;IAC9D;;IAEA,IAAI,CAACG,UAAU,GAAG,WAAWJ,QAAQ,IAAIF,WAAW,EAAE;IACtD,IAAI,CAACO,SAAS,GAAG,IAAIC,IAAI,EAAE;EAC7B;EACAC,eAAeA,CAAA;;IACb,MAAMC,YAAY,GAAa,EAAE;IACjC,IAAI,IAAI,CAACb,cAAc,EAAE;MACvB,IAAI,IAAI,CAACA,cAAc,GAAG,IAAI,CAACU,SAAS,EAAE;QACxC,IAAI,CAAAH,EAAA,OAAI,CAACV,QAAQ,cAAAU,EAAA,uBAAAA,EAAA,CAAEO,UAAU,GAAGC,YAAY,EAAE;UAC5CF,YAAY,CAACG,IAAI,CAAC,gBAAgB,CAAC;QACrC;QACAH,YAAY,CAACG,IAAI,CAAC,YAAY,IAAAzC,UAAA,CAAA0C,oBAAoB,EAAC,IAAI,CAACP,SAAS,EAAE,IAAI,CAACV,cAAc,CAAC,EAAE,CAAC;MAC5F;MACAa,YAAY,CAACG,IAAI,CAAC,GAAG,IAAI,CAACxB,KAAM,CAACoB,eAAe,EAAE,CAAC;MACnD,OAAOC,YAAY;IACrB,CAAC,MAAM;MACL,IAAI,CAAAP,EAAA,OAAI,CAACT,QAAQ,cAAAS,EAAA,uBAAAA,EAAA,CAAEQ,UAAU,GAAGC,YAAY,EAAE;QAC5CF,YAAY,CAACG,IAAI,CAAC,gBAAgB,CAAC;MACrC;MACAH,YAAY,CAACG,IAAI,CAAC,qBAAqB,CAAC;IAC1C;IACA,OAAOH,YAAY;EACrB;EAEQK,KAAKA,CAACC,IAAY;IACxBxC,OAAO,CAACuC,KAAK,CACX5C,WAAA,CAAA8C,YAAY,CAACC,KAAK,EAClBvC,WAAW,EACX,GAAG,GAAG,IAAI,CAACS,UAAU,GAAG,IAAI,GAAG4B,IAAI,CACpC;EACH;EAEQG,YAAYA,CAACC,MAAoB,EAAEC,QAAqB;;IAC9D,IAAI,CAAC,IAAI,CAAC5B,KAAK,EAAE;MACf,IAAI,CAACA,KAAK,GAAG,IAAI;MACjB,IAAI,CAACsB,KAAK,CACR,0BAA0B,GACxBK,MAAM,CAACE,IAAI,GACX,YAAY,GACZF,MAAM,CAACG,OAAO,GACd,eAAe,GACf,IAAI,CAAChB,SAAS,CAACiB,WAAW,EAAE,CAC/B;MACD,MAAMC,WAAW,GAAAC,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KAAQP,MAAM;QAAEC;MAAQ,EAAE;MAC3C,CAAAjB,EAAA,OAAI,CAACT,QAAQ,cAAAS,EAAA,uBAAAA,EAAA,CAAEwB,eAAe,CAACH,WAAW,CAAC;MAC3C,CAAAtB,EAAA,OAAI,CAACP,WAAW,cAAAO,EAAA,uBAAAA,EAAA,CAAA0B,IAAA,OAAGJ,WAAW,CAACH,IAAI,CAAC;IACtC;EACF;EAEAQ,MAAMA,CAAA;;IACJ,IAAI,IAAI,CAACrC,KAAK,EAAE;MACd;IACF;IACA,IAAI,CAAC,IAAI,CAACC,QAAQ,EAAE;MAClB,MAAM,IAAIqC,KAAK,CAAC,4BAA4B,CAAC;IAC/C;IACA,IAAI,CAAChB,KAAK,CAAC,aAAa,CAAC;IACzB,MAAMiB,aAAa,GAAG,IAAI,CAACtC,QAAQ,CAACuC,KAAK,EAAE;IAC3C,MAAMC,UAAU,GAAG,IAAI,CAACpD,OAAO,CAACgD,MAAM,CACpCE,aAAa,EACb,IAAI,CAACjD,UAAU,CAACoD,eAAe,CAChC;IACD,MAAMC,gBAAgB,GAAGF,UAAU,CAACG,UAAU,GAC1C,GAAG,GACHH,UAAU,CAACG,UAAU,CAACC,cAAc,EAAE,CAACC,EAAE,GACzC,IAAI,GACJL,UAAU,CAACG,UAAU,CAACG,UAAU,EAAE,GAClC,EAAE,GAAGN,UAAU,CAACG,UAAU;IAC9B,IAAI,CAACtB,KAAK,CACR,eAAe,GACbzC,QAAA,CAAAmE,cAAc,CAACP,UAAU,CAACQ,cAAc,CAAC,GACzC,eAAe,GACfN,gBAAgB,GAChB,WAAW,IACX,CAAAhC,EAAA,GAAA8B,UAAU,CAACd,MAAM,cAAAhB,EAAA,uBAAAA,EAAA,CAAEkB,IAAI,IACvB,GAAG,IACH,CAAAnB,EAAA,GAAA+B,UAAU,CAACd,MAAM,cAAAjB,EAAA,uBAAAA,EAAA,CAAEoB,OAAO,EAC7B;IACD,QAAQW,UAAU,CAACQ,cAAc;MAC/B,KAAKpE,QAAA,CAAAmE,cAAc,CAACE,QAAQ;QAC1B,IAAI,CAACzD,WAAW,CACb0D,gBAAgB,CAAC;UAAEC,WAAW,EAAE,IAAI,CAACvC;QAAU,CAAE,CAAC,CAClDwC,IAAI,CACHC,aAAa,IAAG;;UACd;;;UAGA,IAAI,IAAI,CAACtD,KAAK,EAAE;YACd,IAAI,CAACsB,KAAK,CACR,2DAA2D,CAC5D;YACD;UACF;UACAiB,aAAa,CAACgB,KAAK,CAACD,aAAa,CAAC;UAClC,IAAIf,aAAa,CAACiB,GAAG,CAAC,eAAe,CAAC,CAAChD,MAAM,GAAG,CAAC,EAAE;YACjD,IAAI,CAACkB,YAAY,CACf;cACEG,IAAI,EAAEnD,WAAA,CAAA+E,MAAM,CAACC,QAAQ;cACrB5B,OAAO,EACL,sDAAsD;cACxD7B,QAAQ,EAAE,IAAIrB,UAAA,CAAA+E,QAAQ;aACvB,EACD,WAAW,CACZ;UACH;UACA,IACElB,UAAU,CAACG,UAAW,CAACgB,oBAAoB,EAAE,KAC7CpF,oBAAA,CAAAqF,iBAAiB,CAACC,KAAK,EACvB;YACA,IAAI,CAACxC,KAAK,CACR,oBAAoB,GAClBqB,gBAAgB,GAChB,aAAa,GACbnE,oBAAA,CAAAqF,iBAAiB,CACfpB,UAAU,CAACG,UAAW,CAACgB,oBAAoB,EAAE,CAC9C,GACD,oDAAoD,CACvD;YACD,IAAI,CAACvB,MAAM,EAAE;YACb;UACF;UAEA,IAAI,IAAI,CAAC3C,QAAQ,KAAKqE,QAAQ,EAAE;YAC9BxB,aAAa,CAACyB,GAAG,CACf,cAAc,EACd,IAAArF,UAAA,CAAAsF,wBAAwB,EAAC,IAAI,CAACvE,QAAQ,CAAC,CACxC;UACH;UACA,IAAI;YACF,IAAI,CAACE,KAAK,GAAG6C,UAAU,CACpBG,UAAW,CAACsB,iBAAiB,EAAE,CAC/BC,UAAU,CAAC5B,aAAa,EAAE,IAAI,CAAC/C,IAAI,EAAE,IAAI,CAACD,UAAU,EAAE;cACrD6E,iBAAiB,EAAEnE,QAAQ,IAAG;gBAC5B,IAAI,CAACqB,KAAK,CAAC,mBAAmB,CAAC;gBAC/B,IAAI,CAACpB,QAAS,CAACkE,iBAAiB,CAACnE,QAAQ,CAAC;cAC5C,CAAC;cACDoE,gBAAgB,EAAEC,OAAO,IAAG;gBAC1B,IAAI,CAAChD,KAAK,CAAC,kBAAkB,CAAC;gBAC9B,IAAI,CAACpB,QAAS,CAACmE,gBAAgB,CAACC,OAAO,CAAC;cAC1C,CAAC;cACDnC,eAAe,EAAER,MAAM,IAAG;gBACxB,IAAI,CAACL,KAAK,CAAC,iBAAiB,CAAC;gBAC7B,IACEK,MAAM,CAAC4C,OAAO,KACdtF,KAAK,CAACuF,SAAS,CAACC,sBAAsB,EACtC;kBACA,IAAI,CAAC/C,YAAY,CAACC,MAAM,EAAE,SAAS,CAAC;gBACtC,CAAC,MAAM;kBACL,IAAI,CAACD,YAAY,CAACC,MAAM,EAAE,WAAW,CAAC;gBACxC;cACF;aACD,CAAC;YACJ,IAAI,CAACvB,cAAc,GAAG,IAAIW,IAAI,EAAE;UAClC,CAAC,CAAC,OAAO2D,KAAK,EAAE;YACd,IAAI,CAACpD,KAAK,CACR,4CAA4C,GAC1CqB,gBAAgB,GAChB,cAAc,GACb+B,KAAe,CAACJ,OAAO,CAC3B;YACD,IAAI,CAAC5C,YAAY,CACf;cACEG,IAAI,EAAEnD,WAAA,CAAA+E,MAAM,CAACC,QAAQ;cACrB5B,OAAO,EACL,2CAA2C,GAC1C4C,KAAe,CAACJ,OAAO;cAC1BrE,QAAQ,EAAE,IAAIrB,UAAA,CAAA+E,QAAQ;aACvB,EACD,aAAa,CACd;YACD;UACF;UACA,CAAAjD,EAAA,IAAAC,EAAA,OAAI,CAACrB,UAAU,EAACqF,WAAW,cAAAjE,EAAA,uBAAAA,EAAA,CAAA0B,IAAA,CAAAzB,EAAA,CAAI;UAC/B,CAAAiE,EAAA,GAAAnC,UAAU,CAACoC,aAAa,cAAAD,EAAA,uBAAAA,EAAA,CAAAxC,IAAA,CAAAK,UAAA,CAAI;UAC5B,IAAI,CAACtC,WAAW,GAAGsC,UAAU,CAACtC,WAAW;UACzC,IAAI,CAACmB,KAAK,CACR,sBAAsB,GAAG,IAAI,CAAC1B,KAAK,CAACkF,aAAa,EAAE,GAAG,GAAG,CAC1D;UACD,IAAI,IAAI,CAACjF,WAAW,EAAE;YACpB,IAAI,CAACD,KAAK,CAACmF,SAAS,EAAE;UACxB;UACA,IAAI,IAAI,CAACjF,cAAc,EAAE;YACvB,IAAI,CAACF,KAAK,CAACoF,sBAAsB,CAC/B,IAAI,CAAClF,cAAc,CAACmF,OAAO,EAC3B,IAAI,CAACnF,cAAc,CAACwE,OAAO,CAC5B;UACH;UACA,IAAI,IAAI,CAACvE,gBAAgB,EAAE;YACzB,IAAI,CAACH,KAAK,CAACsF,SAAS,EAAE;UACxB;QACF,CAAC,EACAR,KAA+B,IAAI;UAClC;UACA,MAAM;YAAE7C,IAAI;YAAEC;UAAO,CAAE,GAAG,IAAA9C,sBAAA,CAAAmG,8BAA8B,EACtD,OAAOT,KAAK,CAAC7C,IAAI,KAAK,QAAQ,GAAG6C,KAAK,CAAC7C,IAAI,GAAGnD,WAAA,CAAA+E,MAAM,CAAC2B,OAAO,EAC5D,mDAAmDV,KAAK,CAACJ,OAAO,EAAE,CACnE;UACD,IAAI,CAAC5C,YAAY,CACf;YACEG,IAAI,EAAEA,IAAI;YACVC,OAAO,EAAEA,OAAO;YAChB7B,QAAQ,EAAE,IAAIrB,UAAA,CAAA+E,QAAQ;WACvB,EACD,WAAW,CACZ;QACH,CAAC,CACF;QACH;MACF,KAAK9E,QAAA,CAAAmE,cAAc,CAACqC,IAAI;QACtB,MAAM;UAAExD,IAAI;UAAEC;QAAO,CAAE,GAAG,IAAA9C,sBAAA,CAAAmG,8BAA8B,EACtD1C,UAAU,CAACd,MAAO,CAACE,IAAI,EACvBY,UAAU,CAACd,MAAO,CAACG,OAAO,CAC3B;QACDwD,YAAY,CAAC,MAAK;UAChB,IAAI,CAAC5D,YAAY,CACf;YAAEG,IAAI;YAAEC,OAAO;YAAE7B,QAAQ,EAAEwC,UAAU,CAACd,MAAO,CAAC1B;UAAQ,CAAE,EACxD,MAAM,CACP;QACH,CAAC,CAAC;QACF;MACF,KAAKpB,QAAA,CAAAmE,cAAc,CAACuC,iBAAiB;QACnC,IAAI,IAAI,CAACtF,QAAQ,CAACiB,UAAU,EAAE,CAACC,YAAY,EAAE;UAC3C,IAAI,CAAC9B,OAAO,CAACmG,gBAAgB,CAAC,IAAI,CAAC;QACrC,CAAC,MAAM;UACL,MAAM;YAAE3D,IAAI;YAAEC;UAAO,CAAE,GAAG,IAAA9C,sBAAA,CAAAmG,8BAA8B,EACtD1C,UAAU,CAACd,MAAO,CAACE,IAAI,EACvBY,UAAU,CAACd,MAAO,CAACG,OAAO,CAC3B;UACDwD,YAAY,CAAC,MAAK;YAChB,IAAI,CAAC5D,YAAY,CACf;cAAEG,IAAI;cAAEC,OAAO;cAAE7B,QAAQ,EAAEwC,UAAU,CAACd,MAAO,CAAC1B;YAAQ,CAAE,EACxD,WAAW,CACZ;UACH,CAAC,CAAC;QACJ;QACA;MACF,KAAKpB,QAAA,CAAAmE,cAAc,CAACyC,KAAK;QACvB,IAAI,CAACpG,OAAO,CAACmG,gBAAgB,CAAC,IAAI,CAAC;IACvC;EACF;EAEAE,gBAAgBA,CAAC/D,MAAc,EAAEG,OAAe;;IAC9C,IAAI,CAACR,KAAK,CACR,yBAAyB,GAAGK,MAAM,GAAG,aAAa,GAAGG,OAAO,GAAG,GAAG,CACnE;IACD,CAAAnB,EAAA,OAAI,CAACf,KAAK,cAAAe,EAAA,uBAAAA,EAAA,CAAE+E,gBAAgB,CAAC/D,MAAM,EAAEG,OAAO,CAAC;IAC7C,IAAI,CAACJ,YAAY,CACf;MAAEG,IAAI,EAAEF,MAAM;MAAEG,OAAO,EAAEA,OAAO;MAAE7B,QAAQ,EAAE,IAAIrB,UAAA,CAAA+E,QAAQ;IAAE,CAAE,EAC5D,WAAW,CACZ;EACH;EACAgC,OAAOA,CAAA;;IACL,OAAO,CAAAjF,EAAA,IAAAC,EAAA,OAAI,CAACf,KAAK,cAAAe,EAAA,uBAAAA,EAAA,CAAEgF,OAAO,EAAE,cAAAjF,EAAA,cAAAA,EAAA,GAAI,IAAI,CAACrB,OAAO,CAACuG,SAAS,EAAE;EAC1D;EACAC,KAAKA,CACH5F,QAAkB,EAClBC,QAA+C;IAE/C,IAAI,CAACoB,KAAK,CAAC,cAAc,CAAC;IAC1B,IAAI,CAACpB,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACD,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACoC,MAAM,EAAE;EACf;EACA2C,sBAAsBA,CAACC,OAAuB,EAAEX,OAAe;IAC7D,IAAI,CAAChD,KAAK,CAAC,wCAAwC,GAAGgD,OAAO,CAAC9D,MAAM,CAAC;IACrE,IAAI,IAAI,CAACZ,KAAK,EAAE;MACd,IAAI,CAACA,KAAK,CAACoF,sBAAsB,CAACC,OAAO,EAAEX,OAAO,CAAC;IACrD,CAAC,MAAM;MACL,IAAI,CAACxE,cAAc,GAAG;QAAEmF,OAAO;QAAEX;MAAO,CAAE;IAC5C;EACF;EACAS,SAASA,CAAA;IACP,IAAI,CAACzD,KAAK,CAAC,kBAAkB,CAAC;IAC9B,IAAI,IAAI,CAAC1B,KAAK,EAAE;MACd,IAAI,CAACA,KAAK,CAACmF,SAAS,EAAE;IACxB,CAAC,MAAM;MACL,IAAI,CAAClF,WAAW,GAAG,IAAI;IACzB;EACF;EACAqF,SAASA,CAAA;IACP,IAAI,CAAC5D,KAAK,CAAC,kBAAkB,CAAC;IAC9B,IAAI,IAAI,CAAC1B,KAAK,EAAE;MACd,IAAI,CAACA,KAAK,CAACsF,SAAS,EAAE;IACxB,CAAC,MAAM;MACL,IAAI,CAACnF,gBAAgB,GAAG,IAAI;IAC9B;EACF;EACA+F,cAAcA,CAACrG,WAA4B;IACzC,MAAM,IAAI6C,KAAK,CAAC,yBAAyB,CAAC;EAC5C;EAEAwC,aAAaA,CAAA;IACX,OAAO,IAAI,CAACnF,UAAU;EACxB;;AArUFoG,OAAA,CAAA5G,iBAAA,GAAAA,iBAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}